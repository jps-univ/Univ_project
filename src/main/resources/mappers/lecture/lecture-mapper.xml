<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="lectureMapper">
    <!--    과목의 리절트맵-->
    <resultMap id="lectureMap" type="Lecture">
        <id property="classSeq" column="CLASS_SEQ"/>
        <result property="classCode" column="CLASS_CODE"/>
        <result property="deptCode" column="DEPARTMENT_CODE"/>
        <result property="profId" column="PROFESSOR_ID"/>
        <result property="className" column="CLASS_NAME"/>
        <result property="room" column="ROOM"/>
        <result property="gradeSize" column="GRADE_SIZE"/>
        <result property="classSemester" column="CLASS_SEMESTER"/>
        <result property="classYear" column="CLASS_YEAR"/>
        <result property="classApprove" column="CLASS_APPROVE"/>
        <result property="classLevel" column="CLASS_LEVEL"/>
        <result property="classType" column="CLASS_TYPE"/>

        <result property="lectureTime" column="TOTAL"/>
        <result property="profName" column="PROFESSOR_NAME"/>
    </resultMap>
    <!--    강의시간 리절트맵-->
    <resultMap id="lectureTimeMap" type="LectureTime">
        <id property="ctSeq" column="CLASS_TIME_SEQ"/>
        <result property="classSeq" column="CLASS_SEQ"/>
        <result property="day" column="DAY"/>
        <result property="hour" column="HOUR"/>
    </resultMap>

    <select id="selectClassTime" resultMap="lectureMap">
        SELECT a.CLASS_SEQ,
               a.CLASS_NAME,
               c.DEPARTMENT_NAME AS DEPARTMENT_CODE,
               d.NAME            AS PROFESSOR_NAME,
               subquery1.total,
               a.ROOM,
               a.CLASS_TYPE,
               a.GRADE_SIZE
        FROM TB_CLASS a,
             (SELECT CLASS_SEQ, LISTAGG(CONCAT(DAY, HOUR), '/') WITHIN GROUP (ORDER BY CLASS_TIME_SEQ ) AS total
              FROM TB_CLASS_TIME b
              GROUP BY CLASS_SEQ) subquery1,
             TB_DEPARTMENT c,
             TB_PROFESSOR d
        WHERE subquery1.CLASS_SEQ = a.CLASS_SEQ
          AND a.DEPARTMENT_CODE = c.DEPARTMENT_CODE
          AND a.PROFESSOR_ID = d.PROFESSOR_ID
    </select>
    <select id="selectMajor" resultMap="lectureMap" parameterType="Lecture">
        SELECT a.CLASS_NAME
        FROM TB_CLASS a, TB_DEPARTMENT b
        WHERE a.DEPARTMENT_CODE=b.DEPARTMENT_CODE AND b.DEPARTMENT_NAME=#{className}
    </select>
</mapper>